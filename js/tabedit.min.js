var CTabaleEdit=function(){var a=function(a){this.obj=a,this.request=null,this.pagesize=10,this.paginate=!1,this.current_page=1,this.ResultClickEdit="undefined",this.ResultClickAdd="undefined",this.ResultClickDelete="undefined",this.lastEditButton="undefined"};a.prototype.Init=function(a,b){let g=d(a);this.id=a,g.arr=[];let h=e("thead",g)[0].rows[0],i=e("tbody",g)[0].rows,j=h.cells.length,k=i.length;for(let d,e=0;e<j;e++)d=h.cells[e],"nosort"!=d.className&&(d.className=this.head,d.onclick=new Function(this.obj+".RowSort(this.cellIndex)"));for(let d=0;d<k;d++)g.arr[d]={};if(null!=b){let a=new Function(this.obj+".RowSort("+b+")");a()}this.paginate&&this.Pages(),null==b&&this.InitEdit()},a.prototype.InitEdit=function(){let a=d(this.id);for(let b,d=0;d<a.rows.length-1;d++)b=e("tbody",a)[0].rows[d].cells[e("thead",a)[0].rows[0].cells.length-1],e("input",b).edit.onclick=new Function(this.obj+".onClickEdit(this)"),e("input",b).delete.onclick=new Function(this.obj+".onClickDelete(this)")},a.prototype.EndEdit=function(a,b){let g=d(this.id),h=e("thead",g)[0].rows[0];for(let d=0;d<h.cells.length-1;d++){if("noedit"==h.cells[d].id)continue;let a=e("tbody",g)[0].rows[b-1].cells[d];a.innerHTML=a.firstChild.value}a.value=String.fromCharCode(1e4)},a.prototype.BeginEdit=function(a,b){let g=d(this.id),h=e("thead",g)[0].rows[0],j=!1;for(let d=0;d<h.cells.length-1;d++){if("noedit"==h.cells[d].id)continue;let a=e("tbody",g)[0].rows[b-1].cells[d];a.innerHTML="<input class=\"inpute\" type=\"text\" size=\""+a.innerText.length+"\"value=\""+a.innerHTML+"\">",j||(a.firstChild.focus(),j=!0)}a.value=String.fromCharCode(10004)},a.prototype.pressedClickEdit=function(a){this.EndEdit(a,a.parentElement.parentElement.rowIndex),this.lastEditButton="undefined";let b=d(this.id);if("undefined"!=this.ResultClickEdit){let d=[];for(let g=0;g<e("thead",b)[0].rows[0].cells.length-1;g++)d[g]=e("tbody",b)[0].rows[a.parentElement.parentElement.rowIndex-1].cells[g].innerText;this.ResultClickEdit(d)}},a.prototype.onClickEdit=function(a){let b=a.parentElement.parentElement.rowIndex;a.value===String.fromCharCode(1e4)?"undefined"===this.lastEditButton?(this.lastEditButton=a,this.BeginEdit(a,b)):(this.EndEdit(this.lastEditButton,this.lastEditButton.parentElement.parentElement.rowIndex),this.lastEditButton=a,this.BeginEdit(a,b)):this.pressedClickEdit(a)},a.prototype.onClickDelete=function(a){if("undefined"!=this.lastEditButton&&this.pressedClickEdit(this.lastEditButton),!confirm("\u0423\u0434\u0430\u043B\u0438\u0442\u044C!!!"))return;let b=d(this.id),g=e("tbody",b)[0].rows,h=e("thead",b)[0].rows[0],i=a.parentElement.parentElement.rowIndex;if("undefined"!=this.ResultClickDelete){let b=[];for(let d=0;d<h.cells.length-1;d++)b[d]=g[a.parentElement.parentElement.rowIndex-1].cells[d].innerText;ResultClickDelete(b)}b.deleteRow(i),b.arr.splice(b.arr.indexOf(i),1),this.Pages(),d(this.limitid).innerHTML=this.numPages,this.current_page>this.numPages&&(d(this.currentid).innerHTML=this.numPages,this.current_page=this.numPages),this.Page((this.current_page-1)*this.pagesize);let j=g.length;for(let d=0;d<j;d++){b.arr[d].numberCell=d;let a=g[d].cells[b.row_sort];for(;a.hasChildNodes();)a=a.firstChild;b.arr[d].valueCell=a.nodeValue?a.nodeValue:""}let k=h.cells.length,l=document.createElement("tbody");for(let d,h=0;h<j;h++){d=g[b.arr[h].numberCell].cloneNode(!0),l.appendChild(d),d.className=0==h%2?this.even:this.odd;let a=e("td",d);for(let d=0;d<k;d++)a[d].className=b.row_sort==d?0==h%2?this.evensel:this.oddsel:""}b.replaceChild(l,e("tbody",b)[0]),this.InitEdit()},a.prototype.showWinModal=function(){"undefined"!=this.lastEditButton&&this.pressedClickEdit(this.lastEditButton);let a=d(this.id),b=e("thead",a)[0].rows[0];var g=document.createElement("div");g.id="shadow",document.body.appendChild(g);var h=d("popupWin");g.onclick=function(){return g.parentNode.removeChild(g),h.style.display="none",!1},h.innerHTML="<table cellspacing=\"0\" id=\"add_product\" class=\"sorttable\" style=\"width:95%\"></table><br /><input class=\"btn\" id=\"bt_add\" type=\"button\" value=\"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C...\" />&nbsp;&nbsp;&nbsp;<input id=\"bt_close\" class=\"btn\" type=\"button\" value=\"\u0417\u0430\u043A\u0440\u044B\u0442\u044C\" />",d("bt_close").onclick=function(){g.onclick()};let j=d("add_product");d("bt_add").onclick=function(){if("undefined"!=this.ResultClickAdd){let a=[];for(let b,d=0;d<j.rows[1].cells.length;d++){if(b=j.rows[1].cells[d].children[0].value,!b)return alert("Fill in all the fields!"),!1;a[d]=b}ResultClickAdd(a)}g.onclick()},j.insertRow(0),j.insertRow(1),j.rows[1].bgColor="#ecf2f6";let k=0;for(let a=0;a<b.cells.length-1;a++)"noedit"!=b.cells[a].id&&(j.rows[0].appendChild(document.createElement("TH")),j.rows[0].cells[k].innerHTML=b.cells[a].innerHTML,j.rows[1].insertCell(k),j.rows[1].cells[k].innerHTML="<input class=\"inpute\" type=\"text\" size=\"15\" value=\"\" >",k++);h.style.display="block",j.rows[1].cells[0].firstChild.focus()},a.prototype.RowSort=function(a){"undefined"!=this.lastEditButton&&this.pressedClickEdit(this.lastEditButton);let g=d(this.id),h=e("thead",g)[0].rows[0],j=e("tbody",g)[0].rows,k=j.length,l=h.cells.length;for(let b=0;b<k;b++){g.arr[b].numberCell=b;let d=j[b].cells[a];for(j[b].style.display="";d.hasChildNodes();)d=d.firstChild;g.arr[b].valueCell=d.nodeValue?d.nodeValue:""}for(let b,d=0;d<l;d++)b=h.cells[d],"nosort"!=b.className&&(b.className=this.head);g.row_sort==a?(g.arr.reverse(),h.cells[a].className=g.type_sort?this.asc:this.desc,g.type_sort=g.type_sort?0:1):(g.row_sort=a,g.arr.sort(b),g.type_sort=0,h.cells[a].className=this.asc);let m=document.createElement("tbody");for(let b,d=0;d<k;d++){b=j[g.arr[d].numberCell].cloneNode(!0),m.appendChild(b),b.className=0==d%2?this.even:this.odd;let h=e("td",b);for(let b=0;b<l;b++)h[b].className=a==b?0==d%2?this.evensel:this.oddsel:""}g.replaceChild(m,e("tbody",g)[0]),this.paginate&&this.Size(this.pagesize),this.InitEdit()},a.prototype.Page=function(a){let b=a+this.pagesize,g=e("tbody",d(this.id))[0].rows,h=g.length;this.currentid&&this.limitid&&(d(this.currentid).innerHTML=this.current_page);for(let d=0;d<h;d++)g[d].style.display=d>=a&&d<b?"":"none"},a.prototype.Move=function(a,b){"undefined"!=this.lastEditButton&&this.pressedClickEdit(this.lastEditButton);let d=1==a?b?this.numPages:this.current_page+1:b?1:this.current_page-1;d<=this.numPages&&0<d&&(this.current_page=d,this.Page((this.current_page-1)*this.pagesize))},a.prototype.Size=function(a){this.pagesize=parseInt(a),this.Pages(),this.current_page>this.numPages&&(this.current_page=this.numPages),this.Page((this.current_page-1)*this.pagesize),this.currentid&&this.limitid&&(d(this.limitid).innerHTML=this.numPages)},a.prototype.Pages=function(){let a=e("tbody",d(this.id))[0].rows,b=a.length;this.numPages=Math.ceil(b/this.pagesize)},a.prototype.createRequest=function(){this.request=null;try{this.request=new XMLHttpRequest}catch(a){try{this.request=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{this.request=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){this.request=null}}}return null==this.request&&alert("Error creating XMLHttpRequest!"),this.request},a.prototype.runRequest=function(a,b,d,e){null==this.request||(this.request.open(a,b,!0),this.request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),this.request.onreadystatechange=new Function(this.obj+".onReadyStateChange(\""+e+"\")"),this.request.send(d))},a.prototype.onReadyStateChange=function(a){if(null!=this.request&&4===this.request.readyState)if(200===this.request.status)switch(a){case"add":if(value=parseInt(this.request.responseText),value){let a=d(this.id),g=d("add_product"),h=e("tbody",a)[0],k=e("thead",a)[0].rows[0];h.insertRow();let l=h.rows.length-1;h.rows[l].insertCell(),h.rows[l].cells[0].innerHTML=value;for(let a=0;a<g.rows[1].cells.length;a++)h.rows[l].insertCell(),h.rows[l].cells[a+1].innerHTML=g.rows[1].cells[a].children[0].value;h.rows[l].insertCell();let m=h.rows[l].cells[h.rows[l].cells.length-1];m.innerHTML=h.rows[l-1].cells[h.rows[l].cells.length-1].innerHTML,m.children.edit.onclick=new Function(this.obj+".onClickEdit(this)"),m.children["delete"].onclick=new Function(this.obj+".onClickDelete(this)"),a.arr[l]={},a.arr[l].numberCell=l;let o=h.rows[l].cells[a.row_sort];for(;o.hasChildNodes();)o=o.firstChild;a.arr[l].valueCell=o.nodeValue?o.nodeValue:"",a.arr.sort(b);let p=document.createElement("tbody");for(let b,d=0;d<h.rows.length;d++){b=h.rows[a.arr[d].numberCell].cloneNode(!0),p.appendChild(b),b.className=0==d%2?this.even:this.odd;let g=e("td",b);for(let b=0;b<k.cells.length;b++)g[b].className=a.row_sort==b?0==d%2?this.evensel:this.oddsel:""}a.replaceChild(p,e("tbody",a)[0]),this.paginate&&this.Size(this.pagesize),this.InitEdit()}else alert("Error: no data added!");break;case"edit":!1==this.request.responseText&&alert("Error: data has not changed!");break;case"del":!1==this.request.responseText&&alert("Error: data is not deleted!");break;default:alert("Error: requested operation not found!");}else alert("Error! Request status is "+this.request.status)};var b=function(a,b){let d=f=a.valueCell.toLowerCase(),e=c=b.valueCell.toLowerCase(),j=parseFloat(f.replace(/(\$|\,)/g,"")),k=parseFloat(c.replace(/(\$|\,)/g,""));return isNaN(j)||isNaN(k)||(d=j,e=k),j=Date.parse(f),k=Date.parse(c),isNaN(j)||isNaN(k)||(d=j,e=k),d>e?1:d<e?-1:0},d=function(a){return document.getElementById(a)},e=function(a,b){return b.getElementsByTagName(a)};return a}();